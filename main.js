
/* ========== تبديل الوضع الليلي/النهاري مع الحفظ ========== */
(function () {
  const body = document.body;
  const btn = document.getElementById("themeToggle");
  const saved = localStorage.getItem("theme");

  if (saved === "dark") {
    body.classList.add("dark");
    btn.innerHTML = '<i class="bi bi-brightness-high me-1"></i> النمط الفاتح';
  }

  btn.addEventListener("click", () => {
    body.classList.toggle("dark");
    const isDark = body.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");

    btn.innerHTML = isDark
      ? '<i class="bi bi-brightness-high me-1"></i> النمط الفاتح'
      : '<i class="bi bi-moon-stars me-1"></i> تبديل النمط';
  });
})();

/* ========== محتوى الدروس (كما هو بدون تغيير) ========== */
const LESSONS = [
  {
    id: "lesson-1",
    title: "قيمة العمل",
    content: `
      <h5 class="mb-2">الدرس الثاني</h5>
      <p>يحتاج الإنسان إلى العمل النافع المثمر من أجل أن يُحافظ على بقائه، وكذلك من أجل تحقيق طموحاته وآماله، وقد بذل الإنسان جهودا كبيرة - منذ القدم - من أجل الحصول على المأكل والمشرب والملبس والمسكن.</p>
      <p>وقد يكون العمل فكريًا أو عضليا، ويحتاج العمل الفكري إلى طاقة ذهنية، ويظهر لك في الإدارة والقيادة والتنظيم والاختراع. ويتطلب العمل العضلي بذل طاقة عضلية مثل عمل الفلاح والعامل والصانع.</p>
      <p>وقد حث الدين على العمل؛ لأن العمل لون من ألوان العبادة، ورسالة العمل هي عمران الأرض، فالله يبارك اليد التي تعمل. قال رسول الله ﷺ: «مَنْ بَاتَ كَالًا مِنْ عَمَلٍ يَدِهِ بَاتَ مَعْفُورًا له».</p>
      <p>والعمل هو خط الدفاع الذي يحمي المرء من مكاره اليأس والقلق، وهو الينبوع الذي يفيض على النفس مشاعر الفوز وكسب الحياة، وهكذا نرى أن شخصية الإنسان تتجلى في العمل؛ لأنه يستخدم فيه أسمى مواهبه فيسيطر على الطبيعة، ويستثمرها لمصلحته.</p>
      <p>والحقيقة أن العمل سواء أكان فكريا أم عضليا، يحفظ كرامة الإنسان، وينمي شخصيته ويقوم سلوكه ويرفع مستواه الخلقي، ويزيد إحساسه بالتضامن مع الجماعة ويشعره بجدارته أن يعيش. ولا شيء أكثر ضررا على الإنسان وأدعى إلى انتشار المفاسد والرذائل من حياة البطالة والكسل، لذا يجب على الإنسان أن يحسن اختيار العمل الذي يلائم ميوله واستعداداته؛ حتى يشعر بالمتعة في أثناء قيامه بالعمل، وحتى يكون أكثر قدرة على الإنتاج، وأكثر احتراما لمهنته، ومن العيب والخطر أن يضطلع الإنسان بتحقيق غايات لا سبيل إلى تحقيقها؛ لأن الفشل قد يقضي على الثقة بالنفس، وعلى النشاط أيضًا. ومن واجبه أيضًا أن يقوم بعمله بأمانة وإخلاص، ونزاهة واجتهاد وإتقان.</p>
      <blockquote class="blockquote p-3 rounded-3 bg-light">قال رسول الله ﷺ: «إِنَّ اللهَ يحب إذا عَمِلَ أحدكم عملاً أن يُتقِنه».</blockquote>
      <p>وسيظل العمل أقوى دعائم النهضة في الأمة، كما أنه سيظل أكبر قيم الحياة، والعصر الحديث عصر العمل، ولكنه العمل الذي يوجهه العلم الحديث، ويسدد خطاه على التطبيق العملي الناجح، ثم إنه العمل الذي تحفزه طاقة الإيمان بما لها من قوة دافعة، وحماسة متقدة، ورعاية واعية تهديه إلى أقوم سبيل، وأشرف غاية.</p>
      <p>وليس هناك عمل يزري بالإنسان ما دام شريفًا، وفيه نفع لصاحبه ولمجتمعه. قال رسول الله ﷺ: «لا تحتقرن عملًا من الأعمال ما دام شريفًا».. فالجندي الذي يسهر على أمن الوطن ومستعد لأن يضحي بروحه، والمعلم الذي يعلم النشء ويغرس فيهم مكارم الأخلاق، والطبيب الذي يقوم على العناية بالمرضى وعلاجهم، والعامل في مصنعه، والفلاح في حقله، كل هؤلاء رجال شرفاء، وحتى الذين يقومون بتنظيف الشوارع وجمع القمامة والإفادة منها، إنهم يؤدون عملاً كريماً وبفضلهم ومجهودهم تبدو الحياة جميلة، والشوارع والميادين أنيقة ونظيفة.</p>
      <p>إن العمل يعطي صاحبه مكانة بين الناس، ويُكسبه الاحترام والتقدير من الجميع. قال عُمر بن الخطاب رضي الله عنه: «إني أرى الرجل فيُعجبني، فإذا قيل: لا عمل له، سقط من عيني». فكم من رجلٍ عظيم كان ملء السمع والبصر لم يصل إلى مكانته السامية ومنزلته المرموقة إلا لأنه كان ينهض مبكرًا قبل أن يستيقظ الطير وتطلع الشمس، حرصًا منه على أداء واجبه، متفانيًا في عمله، فسار إلى المجد بخطوات سريعة ثابتة، واحتل مكانة القمة بين أترابه.</p>
      <p>وعمل المرأة في البيت، فضلًا على أنه يتفق وطبيعتها فإنه يحقق لها وللوطن جيلًا صالحًا يحتل بين الشعوب مكانة ممتازة وراقية، والمرأة التي تُحسن العمل في المنزل تُبرهن على جدارتها لما يُناط بها من آمال وأحلام. فلا بد لكل إنسان رجلاً كان أم امرأة، صبيًا كان أم شابًا، أن يتقن عمله.</p>
      <blockquote class="blockquote p-3 rounded-3 bg-light">قال تعالى: «إِنَّ الَّذِينَ آمَنُوا وَعَمِلُوا الصَّالِحَاتِ إِنَّا لَا نُضِيعُ أَجْرَ مَنْ أَحْسَنَ عَمَلًا» (الكهف: 30).</blockquote>
      <p>والذين يتواكلون ولا يؤدون عملاً يجب أن يعلموا أن السماء لا تمطر ذهبًا ولا فضة. والتوكل على الله أمر واجب، أما الذين يتكاسلون ويهدرون وقتهم هباءً لا يحققون أهدافهم ولا يصلون إلى النجاح، بل تراهم يُعلّقون فشلهم على الحظ وهم واهمون، فالعمل هو الذي يحقق الحظ السعيد ويتيح الفرص ويؤدي إلى النجاح والمجد، فكل إنسان منا سوف يُحاسب على صحته ووقته فيم أنفقهما؟</p>
      <p>إن العمل المبني على العلم والفكر الناضج والإخلاص والدقة والإتقان هو المقياس الأول لمدى تقدم الأمم، والدعامة القوية لنهضتها وسبقها، وبه تباينت الأمم بين قوية تتقدم الركب وتمضي في الطليعة، وأخرى تلهث في إثرها مقتربة منها أو منقطعة عنها.</p>
      <p>إن إتقان العمل سوف ينعكس بلا شك على الرواج التجاري الداخلي أو الخارجي مما يعود بالنفع على الطبقة الكادحة وتوفير فرص العمل لشبابنا الذي ينتظر الفرصة للمساهمة في بناء الوطن. وفي المجال الصناعي والزراعي والتجاري والفندقي، فكل هذه الأعمال تحتاج إلى إتقان، وسيكون لها أكبر الأثر في نهضة الوطن وتقدمه.</p>
      <p>إن مصرنا الحبيبة في حاجة ماسة إلى العمل الجاد المخلص من كل أبنائها في شتى المجالات، لتمضي إلى غايتها السامية، وتسعد بحياة كريمة، وتحقق أملها في غدٍ أسعد وأفضل.</p>

      <h6 class="mt-4">اللغويات (مختارات من النص):</h6>
      <ul>
        <li><strong>الينبوع:</strong> المصدر.</li>
        <li><strong>اليأس:</strong> انقطاع الأمل.</li>
        <li><strong>الرذائل:</strong> الأفعال القبيحة.</li>
        <li><strong>متفانيًا:</strong> باذلًا قصارى جهده.</li>
        <li><strong>تباينت:</strong> اختلفت.</li>
        <li><strong>الطليعة:</strong> المقدمة.</li>
        <li><strong>كالا:</strong> متعبًا.</li>
        <li><strong>أترابه:</strong> من هم في مثل سنّه.</li>
      </ul>
    `,
    questions: [
      { q: "العمل الفكري يحتاج إلى:", a: "طاقة ذهنية", options: ["طاقة عضلية", "طاقة ذهنية", "أدوات بسيطة"] },
      { q: "«من بات كالًا من عمل يده بات مغفورًا له» يدل على:", a: "فضل العمل اليدوي الشريف", options: ["ذم العمل", "فضل العمل اليدوي الشريف", "التشجيع على البطالة"] },
      { q: "أخطر ما يؤدي إلى انتشار المفاسد والرذائل هو:", a: "البطالة والكسل", options: ["التعليم", "البطالة والكسل", "إتقان العمل"] },
      { q: "رأي عمر بن الخطاب في الرجل بلا عمل:", a: "سقط من عينه", options: ["أُعجب به", "سقط من عينه", "أكرمه"] },
      { q: "المقياس الأول لتقدم الأمم هو:", a: "العمل المبني على العلم والإتقان", options: ["الشعارات الرنانة", "العمل المبني على العلم والإتقان", "الحظ الجيد"] },
      { q: "انعكاس إتقان العمل على الاقتصاد:", a: "يرفع الرواج التجاري ويوفر فرص العمل", options: ["يقلل الإنتاج", "يرفع الرواج التجاري ويوفر فرص العمل", "لا يؤثر"] },
    ],
  },

  {
    id: "lesson-2",
    title: "المفعول لأجله",
    content: `
      <h5 class="mb-2">تعريف وشرح</h5>
      <p><strong>المفعول لأجله</strong> هو اسمٌ منصوب (وقد يأتي مجرورًا) يُذكر في الجملة الفعلية لبيان سبب حدوث الفعل، ويصلح لأن يكون إجابةً لسؤالٍ أداته: «لماذا؟». ويُفضّل أن يكون مصدرًا قلبيًا، متّحدًا مع الفعل في الزمن والفاعل.</p>

      <h6 class="mt-3">أمثلة من النص:</h6>
      <ul>
        <li>يذاكر الطلاب <strong>رغبةً في التفوق</strong>.</li>
        <li>تذهب إلى الريف <strong>استمتاعًا بمناظره الجميلة</strong>.</li>
        <li>تُطِيع الوالدين <strong>أملًا في رضا الله</strong>.</li>
        <li>تُقام المعارض الصناعية <strong>لتشجيع الصناعة</strong>.</li>
        <li>تُوزّع الهدايا <strong>لتكريم الفائقين</strong>.</li>
        <li>أُمارس الرياضة <strong>لتقوية جسمي</strong>.</li>
      </ul>

      <h6 class="mt-3">القاعدة:</h6>
      <p>هو اسمٌ منصوب يبيّن سبب الفعل، ويُعرب مفعولًا لأجله، وقد يُجر بحرف جر إذا ذُكر معه (مثل: لِـ تشجيعِ الصناعةِ). ويصلح جوابًا عن «لماذا؟».</p>

      <h6 class="mt-3">أنشطة وتدريبات:</h6>
      <ol>
        <li><strong>أكمل بمفعول لأجله:</strong> قصدتُ المصيف <em>(للراحة)</em> — يقف الطلاب <em>(احترامًا للأستاذ)</em> — يحافظ الإنسان على البيئة <em>(حفاظًا على صحته)</em> — أَعطِفُ على الفقير <em>(طلبًا لرضا الله)</em> — يذاكر الطالب <em>(رغبةً في العلم)</em>.</li>
        <li><strong>اجعل الكلمات مفعولًا لأجله في جمل:</strong> رغبة — احترامًا — خوفًا — اعترافًا — شوقًا — تكريمًا — طمعًا.</li>
        <li><strong>أجب بـ مفعول لأجله:</strong> لماذا تُفتح المصانع؟ — لماذا نمارس الرياضة؟ — لماذا نذهب للشواطئ صيفًا؟ — لماذا حضرت إلى المدرسة؟</li>
        <li><strong>اختر الصحيح:</strong> تعامل الناس معاملة طيبة <em>طاعةً لله</em> (طاعة — أملًا — رغبة).</li>
      </ol>
    `,
    questions: [
      { q: "المفعول لأجله يجيب عن سؤال:", a: "لماذا", options: ["كيف", "متى", "لماذا"] },
      { q: "نوع الاسم في المفعول لأجله غالبًا يكون:", a: "مصدرًا قلبيًا", options: ["صفة مشبهة", "مصدرًا قلبيًا", "اسم فاعل"] },
      { q: "اختر جملةً تحتوي مفعولًا لأجله:", a: "يذاكر الطلاب رغبةً في التفوق", options: ["جلس الطالب في الفصل", "يذاكر الطلاب رغبةً في التفوق", "ذهب الطالب إلى السوق"] },
      { q: "تُوزّع الهدايا بهدف:", a: "تكريم الفائقين", options: ["تضييع الوقت", "تكريم الفائقين", "المجاملة فقط"] },
      { q: "الأداة الأنسب لجرّ المفعول لأجله هي:", a: "اللام (لِـ)", options: ["الباء", "عن", "اللام (لِـ)"] },
      { q: "إعراب كلمة «رغبةً» في جملة «يذاكر الطالب رغبةً في التفوق»:", a: "مفعول لأجله منصوب", options: ["حال", "تمييز", "مفعول لأجله منصوب"] },
    ],
  },

  {
    id: "lesson-3",
    title: "حكم ونصائح",
    content: `
    <blockquote class="blockquote bg-light p-3 rounded-3">
      <p class="mb-0" style="line-height: 2">
        إذا جاريت في خُلق دنيئًا<br>
        رأيت الحر يجتنب المخازي<br>
        فأنت ومن تجاربه سواء<br>
        وما من شدة إلا سيأتي<br>
        ويحميه عن الغدر الوفاء<br>
        لقد جربت هذا الدهر حتى<br>
        لها من بعد شدتها رخاء<br>
        يعيش المرء ما استحيا بخير<br>
        أفادتني التجارب والعناء<br>
        فلا والله ما في العيش خير<br>
        إذا لم تحش عاقبة الليالي<br>
        ويبقى العود ما بقي اللحاء<br>
        ولا الدنيا إذا ذهب الحياة<br>
        وإن تستحي فاصنع ما تشاء
      </p>
    </blockquote>

    <h5 class="mt-4">الجماليات البلاغية:</h5>
    <ul>
      <li><strong>أسلوب شرط:</strong> إذا جاريت في خلق دنيئًا — يفيد التوكيد.</li>
      <li><strong>استعارة مكنية:</strong> يجتنب المخازي — شبه المخازي بشيء مادي يُتجنّب، سر جمالها التوضيح.</li>
      <li><strong>استعارة مكنية:</strong> يحميه عن الغدر الوفاء — شبه الوفاء بإنسان يحمي، سر جمالها التشخيص.</li>
      <li><strong>طباق:</strong> الغدر — الوفاء؛ يوضح المعنى ويؤكده.</li>
      <li><strong>أسلوب قصر:</strong> وما من شدة إلا سيأتي — للتوكيد والتخصيص.</li>
      <li><strong>استعارة مكنية:</strong> رخاء — شبه الرخاء بإنسان يأتي بعد الشدة، سر جمالها التشخيص.</li>
      <li><strong>استعارة مكنية:</strong> ذهب الحياء — شبه الحياء بشيء مادي يذهب، سر جمالها التوضيح.</li>
      <li><strong>أسلوب أمر:</strong> اصنع ما تشاء — يفيد التهديد، و(ما) تفيد العموم والشمول.</li>
    </ul>

    <h5 class="mt-4">اللغويات:</h5>
    <div class="table-responsive">
      <table class="table table-bordered">
        <thead class="table-light">
          <tr><th>الكلمة</th><th>المعنى</th><th>المضاد</th></tr>
        </thead>
        <tbody>
          <tr><td>جاريت</td><td>سايرت</td><td>خالفت</td></tr>
          <tr><td>سواء</td><td>متساويان</td><td>مختلفان</td></tr>
          <tr><td>المخازي</td><td>المعايب</td><td>المحاسن</td></tr>
          <tr><td>العناء</td><td>التعب</td><td>الراحة</td></tr>
          <tr><td>رخاء</td><td>رفاهية</td><td>ضنك</td></tr>
          <tr><td>اللحاء</td><td>قشر العود والشجر</td><td>الخشب الداخلي</td></tr>
        </tbody>
      </table>
    </div>

    <h5 class="mt-4">نبذة عن الشاعر:</h5>
    <p>
      أبو تمام حبيب بن أوس الطائي، أحد أمراء البيان، وُلد عام 188م بجاسم من قرى حوران (سوريا)،
      ورحل إلى مصر، ثم استقدمه المعتصم إلى بغداد. عُرف بالذكاء الشديد، وكان يحفظ آلاف الأراجيز
      والقصائد. تميز شعره بالقوة والبلاغة، وتوفي بالموصل عام 231م.
    </p>

    <hr class="my-4" />
    <div class="text-center text-muted mt-4" style="font-family: 'Tajawal'; font-weight: 700; letter-spacing: .5px;">
      © 2025 — إعداد الطالب: <span style="font-family: 'Tajawal'; font-weight: 700;">عبدالرحمن محمد أشرف</span>
    </div>
  `,
    questions:[
    { q: '1) نوع الأسلوب في "إذا جاريت في خلق دنيئًا":', options: ['أمر', 'شرط', 'قصر'], answer: 1 },
    { q: '2) "يجتنب المخازي" تُعد:', options: ['طباق', 'كناية', 'استعارة مكنية'], answer: 2 },
    { q: '3) الطباق في البيت يظهر بين:', options: ['العناء — رخاء', 'الغدر — الوفاء', 'العيش — الخير'], answer: 1 },
    {q: '4) "وما من شدة إلا سيأتي" هو:', options: ['حصر وقصر', 'نداء', 'تشبيه'], answer: 0 },
    { q: '5) "اصنع ما تشاء" يفيد:', options: ['التعجب', 'التهديد والعموم', 'التمني'], answer: 1 },
    {q: '6) معنى "اللحاء" هو:', options: ['قشر العود والشجر', 'التعب', 'الخشب الداخلي'], answer: 0 },
  ],
  },
];

// ← سيب المصفوفة بتاعتك زي ما هي تمامًا

/* ========== بناء واجهة الدروس ========== */
function buildLessons() {
  const container = document.getElementById("lessons");
  container.innerHTML = "";

  LESSONS.forEach((ls, idx) => {
    const section = document.createElement("section");
    section.className = "lesson card shadow-sm mb-4 reveal";
    section.id = ls.id;

    section.innerHTML = `
      <div class="card-body">
        <h2 class="card-title mb-3">${ls.title}
          <span class="chip">درس ${idx + 1}</span>
        </h2>

        ${ls.content}

        <hr class="my-4" />
        <h5 class="mb-3">أسئلة اختيار من متعدد</h5>

        <form class="quiz" data-quiz-id="${ls.id}">
          ${ls.questions.map((q, i) => `
            <div class="mb-3">
              <label class="form-label">${i + 1}) ${q.q}</label>
              ${q.options.map((opt, j) => `
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="q${i+1}" value="${j}">
                  <label class="form-check-label">${opt}</label>
                </div>
              `).join("")}
            </div>
          `).join("")}

          <div class="d-flex gap-2">
            <button type="button" class="btn btn-success btn-sm evaluate">تقييم</button>
            <button type="button" class="btn btn-outline-secondary btn-sm retry">جرّب مرة أخرى</button>
            <span class="quiz-score ms-auto text-muted small"></span>
          </div>
        </form>
      </div>
    `;

    container.appendChild(section);
  });
}

/* ========== خريطة الإجابات ========== */
const ANSWERS = {};

function buildAnswers() {
  LESSONS.forEach(ls => {
    const key = {};
    ls.questions.forEach((q, idx) => {
      key[`q${idx + 1}`] = String(q.options.indexOf(q.a));
    });
    ANSWERS[ls.id] = key;
  });
}

/* ========== تقييم الاختبار ========== */
function evaluateQuiz(form) {
  const quizId = form.dataset.quizId;
  const key = ANSWERS[quizId];
  let score = 0;
  const total = Object.keys(key).length;

  form.querySelectorAll(".is-correct, .is-wrong").forEach(el => {
    el.classList.remove("is-correct", "is-wrong");
  });

  Object.keys(key).forEach(q => {
    const selected = form.querySelector(`input[name="${q}"]:checked`);
    if (!selected) return;

    if (selected.value === key[q]) {
      score++;
      selected.closest(".form-check").classList.add("is-correct");
    } else {
      selected.closest(".form-check").classList.add("is-wrong");
    }
  });

  const scoreEl = form.querySelector(".quiz-score");
  scoreEl.textContent = `النتيجة: ${score} / ${total}`;
}

/* ========== إعادة المحاولة ========== */
function resetQuiz(form) {
  form.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);

  form.querySelectorAll(".is-correct, .is-wrong").forEach(el => {
    el.classList.remove("is-correct", "is-wrong");
  });

  const scoreEl = form.querySelector(".quiz-score");
  if (scoreEl) scoreEl.textContent = "";
}

/* ========== ربط أزرار التقييم والإعادة ========== */
function attachQuizHandlers() {
  document.querySelectorAll("form.quiz").forEach(form => {
    form.querySelector(".evaluate")
      .addEventListener("click", () => evaluateQuiz(form));

    form.querySelector(".retry")
      .addEventListener("click", () => resetQuiz(form));
  });
}

/* ========== أنيميشن الظهور عند التمرير ========== */
function setupReveal() {
  const revealEls = document.querySelectorAll(".reveal");

  function onScroll() {
    const wh = window.innerHeight;
    revealEls.forEach(el => {
      const rect = el.getBoundingClientRect();
      if (rect.top < wh - 60) el.classList.add("show");
    });
  }

  onScroll();
  window.addEventListener("scroll", onScroll);
}

/* ========== تعديل الفوتر تلقائيًا ========== */
function updateFooter() {
  const footer = document.querySelector("footer small.text-muted");
  if (footer) {
    footer.innerHTML =
      '© 2025 — إعداد الطالب: <span style="font-family: Tajawal; font-weight:700;">عبدالرحمن محمد أشرف</span>';
  }
}

/* ========== تشغيل كل شيء بعد تحميل الصفحة ========== */
document.addEventListener("DOMContentLoaded", () => {
  buildLessons();
  buildAnswers();
  attachQuizHandlers();
  setupReveal();
  updateFooter();
});
